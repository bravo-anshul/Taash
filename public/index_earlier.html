<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Babylon Template</title>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
        </style>

        <script src="https://preview.babylonjs.com/babylon.max.js"></script>
    </head>

   <body>
    <canvas id="renderCanvas" ></canvas>

    <script>
        document.documentElement.webkitRequestFullscreen();
        var canvas = document.getElementById("renderCanvas"); 
        var engine = new BABYLON.Engine(canvas, true);

        var createScene = function(){
            var scene = new BABYLON.Scene(engine);
            //scene.clearColor = new BABYLON.Color3.White();

            // var camera = new BABYLON.FreeCamera("camera1", new BABYLON.Vector3(0,10,-10),scene);
            // camera.setTarget(BABYLON.Vector3.Zero());

            //var ground = BABYLON.MeshBuilder.CreateGround("ground", {}, scene); //default ground
            var body = BABYLON.MeshBuilder.CreateCylinder("body", { height: 0.75, diameterTop: 0.2, diameterBottom: 0.5, tessellation: 6, subdivisions: 1 }, scene);
            var table = BABYLON.MeshBuilder.CreateBox("table", { height: 0.1, width: 5, depth: 5 }, scene);

            table.position = new BABYLON.Vector3(0,-2,6);
            
            body.position = new BABYLON.Vector3(0,-0.2,2);
            body.rotation = new BABYLON.Vector3(0,0,0);
            //var box1 = BABYLON.Mesh.CreateBox("b1", 1.0, scene);
            
            var material = new BABYLON.StandardMaterial("myMaterial", scene);
            material.diffuseColor = new BABYLON.Color3(1, 0, 0);
            table.material = material;

            // var arcCamera = new BABYLON.ArcRotateCamera("arcCamera",
            //                 BABYLON.Tools.ToRadians(-45),
            //                 BABYLON.Tools.ToRadians(45),
            //                 10.0,body.position,scene);
            // arcCamera.attachControl(canvas, true);
            var freeCamera = new BABYLON.FreeCamera("FreeCamera", new BABYLON.Vector3(0, 0, 0), scene);
            freeCamera.rotation = new BABYLON.Vector3(0.4, 0, 0);
            freeCamera.attachControl(canvas,true);
            scene.activeCamera = freeCamera;
            var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(1, 1, 1), scene);
            light.intensity = 0.8;

            //var pointLight = new BABYLON.PointLight("pointLight", new BABYLON.Vector3(0,15,0), scene);
            // pointLight.parent = arcCamera;
            //pointLight.diffuse = new BABYLON.Color3(1,1,1);

             // Creation of a basic animation with box 1
            //----------------------------------------

            //Create a scaling animation at 30 FPS
            // var zAxisAnimation = new BABYLON.Animation("movingAnimation", "position.z", 60, BABYLON.Animation.ANIMATIONTYPE_FLOAT,
            //                                                                 BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);
            var rotationAnimationBox = new BABYLON.Animation("rotatingAnimation", "rotation.x", 30, BABYLON.Animation.ANIMATIONTYPE_FLOAT,
                                                                             BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);
            // var yAxisAnimation = new BABYLON.Animation("yAxisAnimation", "position.y", 60, BABYLON.Animation.ANIMATIONTYPE_FLOAT,
            //                                                                 BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE); 
            var positionAnimation = new BABYLON.Animation("positionAnimation", "position", 60, BABYLON.Animation.ANIMATIONTYPE_VECTOR3,
                                                                            BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);                                                                 
            //Here we have chosen a loop mode, but you can change to :
            //  Use previous values and increment it (BABYLON.Animation.ANIMATIONLOOPMODE_RELATIVE)
            //  Restart from initial value (BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE)
            //  Keep the final value (BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT)

            // Animation keys
            var zAxiskeys = [];
            zAxiskeys.push({
                frame: 0,
                value: new BABYLON.Vector3(0, -0.2, 2)
            });

            zAxiskeys.push({
                frame: 20,
                value: new BABYLON.Vector3(0, -1, 4)
            });

            zAxiskeys.push({
                frame: 80,
                value: new BABYLON.Vector3(0, -1.5, 5)
            });
            
            zAxiskeys.push({
                frame: 100,
                value: new BABYLON.Vector3(0, -2, 6)
            });

            var yAxiskeys = [];
            yAxiskeys.push({
                frame: 0,
                value: 0.2
            });

            yAxiskeys.push({
                frame: 20,
                value: -1.0
            });

            yAxiskeys.push({
                frame: 80,
                value: -1.5
            });
            
            yAxiskeys.push({
                frame: 100,
                value: -2
            });

            //Adding keys to the animation object
            // zAxisAnimation.setKeys(zAxiskeys);
            // yAxisAnimation.setKeys(yAxiskeys);
            rotationAnimationBox.setKeys(yAxiskeys);
            positionAnimation.setKeys(zAxiskeys);

            //Then add the animation object to box1
            //body.animations.push(rotationAnimationBox);
            // var easingFunction = new BABYLON.CircleEase();
            // easingFunction.setEasingMode(BABYLON.EasingFunction.EASINGMODE_EASEINOUT);
            
            // BABYLON.Animation.CreateAndStartAnimation('yAxisAnimation', body, 'position.y', 30, 120, -0.2, -2);
            // BABYLON.Animation.CreateAndStartAnimation('zAxisAnimation', body, 'position.z', 30, 120, 2, 6);
            body.animations.push(positionAnimation);
            body.animations.push(rotationAnimationBox);

            //Finally, launch animations on box1, from key 0 to key 100 with loop activated

            // var animationGroup = new BABYLON.AnimationGroup("my group");
            // animationGroup.addTargetedAnimation(zAxisAnimation, body);
            // animationGroup.addTargetedAnimation(yAxisAnimation, body);

            // Make sure to normalize animations to the same timeline
            // animationGroup.normalize(0, 100);
            // animationGroup.start();
            scene.beginAnimation(body, 0, 100, true);
            console.log(freeCamera.rotation)

            return scene;
        }

        var scene = createScene();
        engine.runRenderLoop(function(){
            scene.render();
        });
        

    </script>

   </body>

</html>